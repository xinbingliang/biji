# Pipeline 语法

* `.gitlab-ci.yml`

`````yaml
before_script:
  - echo "before_script!!"

variables:
  DOMAIN: example.com

stages:
  - build
  - test
  - codescan
  - deploy

build:
  before_script:
    - echo "before_script in job"
  stage: build
  script:
    - echo "mvn clean"
    - echo "mvn install"
    - echo "$DOMAIN"
  after_script:
    - echo "after script in buildjob"

unittest:
  stage: test
  script:
    - echo "run test"
    
unittest2:
  stage: test
  script:
    - echo "run test2"

deploy:
  stage: deploy
  script:
    - echo "hello deploy"
    - sleep 2;

codescan:
  stage: codescan
  script:
    - echo "codescan"
    - sleep 5;

after_script:
  - echo "after_script"
  - ech
`````

##job

使用名为.gitlab-ci.yml的文件配置CI/CD管道（定义的流水线），在文件中可以有多个job，每个作业具有唯一的名称，每个job单独执行。定义了在相关条件下执行的操作，每个job至少包含一个script。

````
job1:
	script: "xxxx"
job2:
	script: "xxxx"
````

## script

## before_script

作业执行之前要做的操作，单个stage中不指定就会执行默认的全局，before_script和script在同一个进程中执行

## after_script

作业执行之后要做的操作，单个stage中不指定就会执行默认的全局

## stages 

指定stage，及执行的顺序

## stage

阶段,可以并行执行多个

并行执行时可能遇到一个执行一个暂停，需要修改runner服务的

`vim /etc/gitlab-runner/comfig.toml`

```
concurrent =10
```

## variables

指定全局的变量

## .pre

stage为.pre放到管道的第一个去运行



## .post

stage为.post 放到管道最后去执行

