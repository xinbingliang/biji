# grpc快速入门

## python下体验protobuf

```
python -m pip install grpcio #安装grpc
python -m pip install grpcio-tools #安装grpc tools
```

* `python -m grpc_tools.protoc --python_out=. --grpc_python_out=. -I. test.proto`
  * `--python_out=` 输出protobuf文件存放位置s
  * `--grpc_python_out` 输出grace文件存放位置

````
.
|____proto
| |____test_pb2_grpc.py
| |____test.proto
| |____test_pb2.py
|____client.py

````

````python
# client.py
from proto import test_pb2

request = test_pb2.HelloRequest()
request.name = "xin"
res = request.SerializeToString()
print(res)

res2 = test_pb2.HelloRequest()
res2.ParseFromString(res)
print(res2.name)
````

## python体验grpc开

```
.
|____server.py
|____proto
| |____helloworld_pb2_grpc.py
| |____helloworld.proto
| |____helloworld_pb2.py
|____client.py
```

```python
from concurrent import futures

import grpc

from grpc_hello.proto import helloworld_pb2, helloworld_pb2_grpc


class Greeter(helloworld_pb2_grpc.GreeterServicer):
    def SayHello(self, request, context):
        return helloworld_pb2.HelloReply(message=f"您好,{request}")


if __name__ == '__main__':
    # 1. 实例化server
    server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))  # 设置线程池
    # 2. 注册逻辑到server中
    helloworld_pb2_grpc.add_GreeterServicer_to_server(Greeter(), server)
    # 3. 启动server
    server.add_insecure_port('0.0.0.0:1234')
    server.start()
    server.wait_for_termination()  # 不要立即结束主程序
```

````python
import grpc

from grpc_hello.proto import helloworld_pb2, helloworld_pb2_grpc

if __name__ == '__main__':
    with grpc.insecure_channel("127.0.0.1:1234") as channel:  # 建立链接
        stub = helloworld_pb2_grpc.GreeterStub(channel)
        rsp: helloworld_pb2.HelloReply = stub.SayHello(helloworld_pb2.HelloRequest(name="xin"))
        print(rsp.message)
````

## python下生产的grpc文件import路径有问题的探讨

```python
# helloworld_pb2_grpc.py
import grpc

from . import helloworld_pb2 as helloworld__pb2

class GreeterStub(object):
```

## go下grpc快速体验

[官方位置](https://github.com/protocolbuffers/protobuf/releases) 并添加到环境变量

* mac安装

```shell
cd protoc-3.6.1-osx-x86_64
cp -r include/ /usr/local/include/
cp -r bin/ /usr/local/bin/
```

* 下载go的依赖包

```
go get github.com/golang/protobuf/protoc-gen-go

cd /Users/xinbingliang/go/bin
cp protoc-gen-go /usr/local/bin/
```

* `protoc -I . goods.proto --go_out=plugins=grpc:.`
* `protoc  --go_out=plugins=grpc:./ helloworld.proto`

## go和python互相调用



## grpc的流模式的定



## grpc的单向流，双向流代码实现





