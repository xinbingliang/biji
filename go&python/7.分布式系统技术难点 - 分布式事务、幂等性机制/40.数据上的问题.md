# 数据上的问题

## 库存数据不一致

1. 事物导致的问题
   * 先扣库存，后创建订单，若调用库存服务成功，订单失败，会涉及到库存归还问题
   * 先订单后扣库存，若网络抖动，
     * 导致库存扣减失败，直接回滚
     * 库存扣减成功，但扣减成功消息回调失败，造成订单回滚
2. 用户造成
   * 用户下单但不支付
     * 只有支付成功才扣减库存【用户体验差】
     * 订单超时，库存归还

## 数据库事务的ACID特性

* 原子性
* 一致性
* 隔离性
* 持久性

## 分布式系统中出现哪些故障会导致数据不一致

* 网络问题-硬件故障、网络抖动、网络阻塞
  * 没有发送出去
  * 发送出去，但没有收到，导致以为出错
* 程序错误
  * 代码异常
  * 宕机
    * 断电
    * 系统问题



















