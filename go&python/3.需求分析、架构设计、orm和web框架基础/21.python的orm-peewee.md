# python的orm-peewee

##  peewee的安装和入门

* `pipenv install peewee`
* `pipenv install  pymysql`

`````python
from peewee import *
import datetime

db = MySQLDatabase("peewee", host="127.0.0.1", user="root",
                   passwd="12345678")


class User(Model):
    username = CharField(unique=True, max_length=120)

    class Meta:
        database = db


class Tweet(Model):
    user = ForeignKeyField(User, backref='tweets')
    message = TextField()
    created_date = DateTimeField(default=datetime.datetime.now)
    is_published = BooleanField(default=True)

    class Meta:
        database = db


if __name__ == '__main__':
    # 1. 生成表结构
    db.connect()
    db.create_tables([User, Tweet])

`````

### 数据添加

````python
# 数据添加
charlie = User(username="charlie")
# charlie.save()  # 即可以完成新建，又可以完成更新，取决于 是否设置了对象的主键值
charlie.save(force_insert=True) # 强制添加
````

````python
huey = User.create(username="xin")
````

### 查询

````python
# 查询 1. 返回的是user对象  2.查询不到会抛出异常
    try:
        charlie = User.get(User.username == "a")
        print(charlie.username)
    except User.DoesNotExist as e:
        print("查询不到")
````

输出执行的sql语句

````
import logging

logger = logging.getLogger("peewee")
logger.setLevel(logging.DEBUG)
logger.addHandler(logging.StreamHandler())
````

`````python
    # 查询 1. 返回的是user对象  2.查询不到会抛出异常
    try:
        # charlie = User.get(User.username == "a")
        charlie1 = User.get_by_id(2)
        print(charlie1.username)
    except User.DoesNotExist as e:
        print("查询不到")
`````

`````python
    users = User.select()
    print(users.sql())
    for user in users:
        print(user.username)
`````

`````python
    usernames = ["charlie", "xin", ""]
    users = User.select().where(User.username.in_(usernames))
    for user in users:
        print(user.username)
`````

## 数据的更新和删除



## 多条插入、 or查询

## 模糊查询、字典展示、排序、limit和去重

## 聚合函数、执行原生的sql语句

## 多表查询和反向查询

## 避免n加1查询问题

