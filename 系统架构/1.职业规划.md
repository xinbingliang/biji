# 职业规划

##职业规划

1. 搭建服务（部署并运行起来）
2. 用好服务（监控、管理、优化）
3. 自动化（服务直接的关联和协同工作）
4. 产品设计（如何设计一个监控系统）

云计算的核心竞争力是运维！

系统架构师：网络 系统 数据库 开发 云计算 自动化 运维管理

## 运维人员工作内容分类

* 监控运维：7*24运维值班、故障处理
* 应用运维：项目上线、业务部署、版本管理、灰度发布
* ​
* 安全运维：整体的安全方案、规范、漏洞检测、安全防护、应用监控
* ​
* 系统运维：架构层面、分布式缓存、分布式文件系统、日志收集、环境规划（测试、开发、生产）、架构设计，性能优化
* 基础服务运维（包含运维开发）：内部DNS、负载均衡、系统监控、资产管理、运维平台
* ​
* 基础设施运维：系统初始化、系统监控、网络维护
* 机房运维：负责设备上下架、巡检、保修、硬件监控


## 自动运维

###标准化

1. 运维标准化
   * 物理设备层面
     1. 服务器标签化、设备负责人、设备采购详情、设备摆放标准。
     2. 网络划分、远程控制卡、网卡端口
     3. 服务器机型、硬盘、内存统一。根据业务分类。
     4. 资产命名规范、编号规范、类型规范
     5. 监控标准
   * 操作系统层面
     1. 操作系统版本
     2. 系统初始化（DNS、NTP、内核参数调优、rsyslog、主机名规范）
     3. 基础Agent配置（Zabbix Agent、Logstash Agent、Saltstack minion）
     4. 系统监控标准（CPU、内存、硬盘、网络、进程）
   * 应用服务层面
     1. Web服务器选型（Apache、Nginx）
     2. 进程启动用户、端口监听规范、日志收集规范（访问日志、错误日志、运行日志）
     3. 配置管理（配置文件规范、脚本规范）
     4. 架构规范（Nginx+Keepalived、LVS+Keepalived等等）
     5. 部署规范（位置、版本、包命名等）
2. 运维操作层面
   * 机房巡检流程（周期，内容，报修流程）
   * 业务部署流程（先测试、后生产、回滚）
   * 故障处理流程（紧急处理、故障升级、重大故障管理）
   * 工作日志标准（如何编写工作日志）
   * 业务上线流程（1. 项目发起 2. 系统安装 3. 部署Nginx 4. 解析域名 5. 测试 6. 加监控 7. 备份）
   * 业务下线流程（谁发起，数据如何处理。）
   * 运维安全规范（密码复杂度、更改周期、VPN使用规范、服务登录规范）

目标： 标准化（规范化，流程化，文档化）

### 工具化

目标：

1. 促进标准化实施
2. 将重复操作简单化
3. 将多次操作流程化
4. 减少人为操作低效和降低故障率

* Shell 脚本（功能性脚本、检查性的、报表性、流程性）
* 开源工具：Zabbix  ELKStack SaltStack Cobbler

痛点：

1. 至少要ssh到服务器执行、可能犯错
2. 多个脚本有执行顺序的时候，可能犯错
3. 权限不好管理，日志没法统计
4. 无法避免手工操作

## web化

* web界面
* 权限控制
* 日志记录
* 弱化流程
* 不用ssh到服务器，减少人为操作故障

## 服务化

* DNS web管理 bind-DLZ dns-api
* 负载均衡web管理  slb-api
* Job管理平台 job-api
* 监控平台 Zabbix zabbix-api
* 操作系统安装平台  cobbler-api
* 部署平台 deploy-api
* 配置管理平台 saltstack-api
* 自动化测试平台 test-api

1. 调用cobbler-api安装操作系统
2. 调用saltstack-api 进行系统初始化
3. 调用dns-api解析主机
4. 调用zabbix-api 将该新上线机器加上监控
5. 调用saltstack-api 部署软件（安装Nginx+php）
6. 调用deploy-api 将当前版本的代码部署到服务器上
7. 调用test-api 测试当前服务是否运行正常
8. 调用slb-api 将该节点加入集群

## 智能化

发展层级

* 智能化：自动化扩容、缩容、服务降级、故障自愈
* 服务化、API化
*  web化、平台化
* 标准化、工具化

触发机制--》决策系统（树）--》

### 1. zabbix 触发Action

1. 当某个集群访问量超过最大支撑量
   1. CPU使用率
   2. 内存使用率
2. 并持续一段时间
3. 不是攻击
4. 资源池有可用资源
   1. 如果是公有云--资金够不够
   2. 当前网络带宽使用率
5. 当前后端服务支撑量是否超过阀值，如果超过应该先扩容后端
6. 数据库是否可以支撑当前并发
7. 当前自动化扩展队列，是否是有正在扩容节点
8. 其他业务相关

### 2. OpenStack 创建虚拟机

### 3. Saltstack 配置环境 --- 监控

### 4. 部署当前代码

### 5. 测试服务是否可用

### 6. 加入集群

### 7. 通知（短信、邮件）

### 缩容

1. 触发条件和决策
2. 从集群中移除节点
3. 通知
4. 移除节点存放到Buffer中
5. Buffer 里面超过一天的虚拟机，自动关闭，存放于xx区域
6. xx区的虚拟机，每七天清理删除