# MYCAT核心配置详解

![](./images/配置文件概览.jpg)

* `server.xml`：对系统参数，用户权限
* `schema.xml`：配置逻辑库，逻辑表
* `log4j2.xml`：配置日志文件
* `rule.xml`：表进行了水平切分时使用的配置文件

## server.xml配置详解

* 配置系统祥光参数
* 配置用户访问权限
* 配置sql防火墙和SQL拦截功能

``````xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mycat:server SYSTEM "server.dtd">
<mycat:server xmlns:mycat="http://io.mycat/">
    <system>
        <property name="serverPort">3306</property> <!-- 定义对外提供服务端口-->
        <property name="managerPort">9066</property> <!-- mycat管理端口 -->
        <property name="nonePasswordLogin">0</property><!-- 是否需要用户登录验证  0为需要密码登陆、1为不需要密码登陆 ,默认为0，设置为1则需要指定默认账户 -->
        <property name="bindIp">0.0.0.0</property> <!-- 监听的IP地址 -->
        <property name="frontWriteQueueSize">2048</property> <!-- 最大写大小 -->
        <property name="charset">utf8</property> <!-- 默认字符集 -->
        <property name="txIsolation">2</property> <!-- 隔离级别 -->
        <property name="processors">8</property> <!-- 进程数量 -->
        <property name="idleTimeout">1800000</property> <!-- 多长时间无连接断开，毫秒 -->
        <property name="sqlExecuteTimeout">300</property> <!-- 执行超时断开时间，秒 -->
        <property name="useSqlStat">0</property>
        <property name="useGlobleTableCheck">0</property>
        <property name="sequnceHandlerType">2</property>
        <property name="defaultMaxLimit">100</property> <!--返回数据集大小 100行 -->
        <property name="maxPacketsize">104857600</property> <!-- 数据包大小  和mysql须保持一致 -->
    </system>

    <!--<user name="root" defaultAcco="true">
        <property name="password">123456</property>
        &lt;!&ndash;<property name="schemas">imooc_db</property>&ndash;&gt;
        <property name="schemas">testdb,db1,db2</property> &lt;!&ndash; 多个数据库设置 &ndash;&gt;
        <property name="readOnly">flase</property> &lt;!&ndash; 是否只读 &ndash;&gt;
    </user>

    &lt;!&ndash;表级DML权限设置&ndash;&gt;
    <user name="test">
        <property name="password">123456</property>
        <property name="schemas">imooc_db</property>
        <privileges check="true"> &lt;!&ndash;true表示是否启用&ndash;&gt;
            <schema name="test1" dml="0110"> &lt;!&ndash;访问test1库 0110拥有的权限 未指定的表使用此dml&ndash;&gt;
                <table name="tb01" dml="0000"></table>&lt;!&ndash;表访问权限&ndash;&gt;
                <table name="tb02" dml="1111"></table>
            </schema>
        </privileges>
    </user>-->

    <user name="root" defaultAccount="true">
        <property name="password">123456</property>
        <property name="schemas">imooc_db</property>
        <!--表级DML权限设置-->
        <privileges check="true">
            <schema name="imooc_db" dml="0110">
                <table name="customer_inf" dml="0000"></table>
                <table name="customer_ level_inf" dml="1111"></table>
            </schema>
        </privileges>
    </user>
    <user name="user">
        <property name="password">123456</property>
        <property name="schemas">imooc_db</property>
        <property name="readOnly">true</property>
    </user>
</mycat:server>
``````

### dml

`````
1111
insert update select delete
`````

### 密码的加密

* `java -cp Mycat-server-1.6.5-release.jar io.mycat.util.DecryptUtil 0:root:123456` 

`````xml
 <user name="root" defaultAccount="true">
        <property name="usingDecrypt">1</property>
        <property name="password">GO0bnFVWrAuFgr1JMuMZkvfDNyTpoiGU7n/Wlsa151CirHQnANVk3NzE3FErx8v6pAcO0ctX3xFecmSr+976QA==</property>
        <property name="schemas">imooc_db</property>
        <!--表级DML权限设置-->
        <privileges check="true">
            <schema name="imooc_db" dml="0110">
                <table name="customer_inf" dml="0000"></table>
                <table name="customer_ level_inf" dml="1111"></table>
            </schema>
        </privileges>
    </user>
`````

* 重启服务
* `mysql -uroot -p -P9066` 测试连接

### 四种隔离级别

[文章](https://blog.csdn.net/weixin_44174165/article/details/89549023)

## log4j2.xml配置文件

* 配置输出日志的格式
* 配置输出日志的级别

````xml
<PatternLayout><!--日志输出格式 %5p 级别 %t 线程名 %m消息-->
	<Pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} %5p [%t] (%l) - %m%n</Pattern>
</PatternLayout>
````

````xml
<!-- ALL < Trace < Debug < Info < Warn < Error < Fatal < Off -->
<asyncRoot level="info" includeLocation="true">
	<AppenderRef ref="RollingFile"/>
</asyncRoot>
````

## rule.xml文件详解

* 水平分表配置规则
* 配置分片规则对应的分片函数

``````xml
<tableRule name="rule1"> <!--分片规则名  尽量有意义-->
  <rule>
    <columns>id</columns> <!--指定分片时的分片列-->
    <algorithm>func1</algorithm> <!--对应的函数， 分片算法-->
  </rule>
</tableRule>
``````

`````xml
<function name="crc32slot" class="io.mycat.route.function.PartitionByCRC32PreSlot"><!--分片函数名 指定java方法-->
	<property name="count">2</property><!-- 要分片的数据库节点数量，必须指定，否则没法分片 -->
</function>
`````



##  常用分片算法(上)

## 常用分片算法(下)

## schema.xml文件用途

## schema定义逻辑库

## table标签

## dataNode标签

## dataHost标签

## dataHost标签属性

## heartbeat标签

## writehost标签







