# URL解析

## URL解析

1. `url.parse(req.url)`，输入 URL 字符串，返回一个对象。 
2. `util.inspect(object)`，返回一个对象的字符串表现形式,。通常用于代码调试。

```javascript
var http = require('http');
var url = require('url');
var util = require('util');

var app = http.createServer(function (req, res) {
    res.writeHead(200 , {"Content-Type":"text/html"});
    console.log(util.inspect(url.parse(req.url)));
    res.end();
});

app.listen(2016);
console.log('监听中');
```

- href: 所解析的完整原始 URL。协议名和主机名都已转为小写。例如: `http://localhost:8888/p/a/t/h?query=string#hash`
- protocol: 请求协议，小写。例如: `http:`
- host: URL主机名已全部转换成小写, 包括端口信息。例如: `localhost:8888`
- auth:URL中身份验证信息部分。例如: `user:pass`，这里没有。
- hostname:主机的主机名部分, 已转换成小写。例如: `host.com`
- port: 主机的端口号部分。例如: `8888`
- pathname: URL的路径部分,位于主机名之后请求查询之前。例如: `/p/a/t/h`
- search: URL 的“查询字符串”部分，包括开头的问号。例如: `?query=string`
- path: pathname 和 search 连在一起。 例如: `/p/a/t/h?query=string`
- query: 查询字符串中的参数部分（问号后面部分字符串），或者使用`querystring.parse()`解析后返回的对象。例如: `query=string` or `{'query':'string'}`
- hash: URL 的 “#” 后面部分（包括 # 符号） 例如: `#hash`

## querystring反序列化

`querystring`的parse方法将一个 query string 反序列化为一个对象

```javascript
var querystring = require('querystring');
var obj = querystring.parse('hello=Node&hello2=Node2');
console.log(obj.hello);
console.log(obj.hello2);
```

## 完整的GET解析

```javascript
var http = require('http');
var url = require('url');
var util = require('util');
var querystring = require('querystring');

var app = http.createServer(function (req, res) {
    var path = url.parse(req.url);
    var pathname = path.pathname;
    var username = querystring.parse(path.query).username;
    var email = querystring.parse(path.query).email;
    if(pathname == '/index'){
        res.writeHead(200 , {"Content-Type":"text/html"});
        res.write('username '+username);
        res.write('email '+email);
        res.end();
    }else{
        res.writeHead(200 , {"Content-Type":"text/html"});
        res.end("<h1>I can't find the page!</h1>");
    }
});

app.listen(2016);
console.log('监听中');
//http://localhost:2016/index?username=zhangsan&email=1@qq.com
```

## POST请求

```javascript
var http = require('http');
var url = require('url');
var util = require('util');
var fs = require('fs');
var querystring = require('querystring');

var app = http.createServer(function (req, res) {
    var path = url.parse(req.url);
    var pathname = path.pathname;
    var username = querystring.parse(path.query).username;
    var email = querystring.parse(path.query).email;
    if(pathname == '/index'){
        fs.readFile('index.html', 'utf8', function (err, data) {
            if(err){
                console.log(err)
            }else{
                res.writeHead(200 , {"Content-Type":"text/html"});
                res.write(data);
                res.end();
            }
        });
    }else{
        var post = '';
        req.on('data', function (chunk) {
            //形式也是?name=abc&
            post += chunk;
        })
        req.on('end', function () {
            post = querystring.parse(post);
            res.writeHead(200,{"Content-Type":"text/html"});
            var name = post.username;
            console.log(name);
            res.end();
        })

    }
});

app.listen(2016);
console.log('监听中');
```