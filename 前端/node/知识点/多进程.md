# 多进程

## 使用stdout进程间传递信息

```
//service.js
'use strict';

const child_process = require('child_process');
let child = child_process.spawn('node', ['./client.js']);

child.stdout.on('data', function(data){
    console.log('stdout:' + data);
})

child.stderr.on('data', function(data){
    console.log('stderr:' + data);
})

child.on('close', function(code){
    console.log('exit code:' + code);
})
```

```
//client.js
'use strict';
const process = require('process');
process.stdout.write('hello ....');

process.exit(0)
```

## kill发送信号

```
'use strict';
const child_process = require('child_process');

let child = child_process.spawn('node', ['./client.js']);

child.kill('SIGTERM')
```

```
'use strict';
const process = require('process');

process.on('SIGTERM', function(){   //请求中断信号，内部打印不会执行
    console.log('收到主进程发来的信号');
    process.exit();
});
```

## IPC双向数据通信

```
'use strict';
const child_process = require('child_process');

let child = child_process.spawn('node', ['./client.js'], {
    stdio: [0, 1, 2, 'ipc']
});


child.on('message', function(msg){
    console.log(msg);
});

child.send({hello: 'hello'})
```

````
'use strict';
const process = require('process');

process.on('message', function(msg){
    msg.hello = msg.hello.toUpperCase();
    console.log('...', msg.hello);
    process.send(msg)
})
````

## 守护子进程

````
'use strict';
const child_process = require('child_process');

function spawn(mainModule){
    let worker = child_process.spawn('node', [mainModule]);

    worker.on('exit', function(code){
        if(code !== 0){
            console.log('restarting....');
            spawn(mainModule);
        }
    })
}

spawn('./client.js')
````



















