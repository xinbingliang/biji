# 测试

## 单元测试

```javascript
//index.js
'use strict';

var fibonacci = function(n){
    if(n === 0){
        return 0;
    }

    if(n === 1){
        return 1;
    }

    return fibonacci(n - 1) + fibonacci(n-2);
}

//这里都是main
if(require.main === module){
    console.log('单元测试');
    let n = Number(process.argv[2]);

    console.log('fibonacci(' + n + ') is', fibonacci(n));
} else {
    console.log('没有进入单元测试');
}
```

## 执行测试

### 安装库

* npm install mocha -g
* npm install should -g

## test.js

````javascript
//test.js
'use strict';

const index = require('./index'); 
const should = require('should');

describe('test.js', function(){
    it('n = 10的时候结果为55', function () {
        index.fibonacci(10).should.equal(55);
    });
})
````

* 执行命令mocha

## 更多测试

```javascript
'use strict';

const index = require('./index'); 
const should = require('should');

describe('test.js', function(){
    it('n=0时，结果为0', function(){
        index.fibonacci(0).should.equal(0);
    });

    it('n=1时，结果为1', function(){
        index.fibonacci(1).should.equal(1);
    });

    it('n=10时，结果为55', function(){
        index.fibonacci(10).should.equal(55);
    });

    it('n>10时，应该报错', function(){
        (function(){
            index.fibonacci(11);
        }).should.throw('n should <= 10');
    });

    it('n < 0时，应该报错', function(){
        (function(){
            index.fibonacci(-1);
        }).should.throw('n should > 0');
    });

    it('n 应该是一个数字', function(){
        (function(){
            index.fibonacci('呵呵');
        }).should.throw('n should be a Number');
    });
})
```

* 最后三个测试不能通过

## 更新fibonacci 后重试

````javascript
'use strict';

var fibonacci = function(n){
  if (typeof n !== 'number') {
    throw new Error('n should be a Number');
  }
  if (n < 0) {
    throw new Error('n should > 0')
  }
  if (n > 10) {
    throw new Error('n should <= 10');
  }
  if (n === 0) {
    return 0;
  }
  if (n === 1) {
    return 1;
  }

  return fibonacci(n-1) + fibonacci(n-2);
}

//这里都是main
if(require.main === module){
    console.log('单元测试');
    var n = Number(process.argv[2]);

    console.log('fibonacci(' + n + ') is', fibonacci(n));
}

exports.fibonacci = fibonacci;
````

所有测试通过

## 测试的覆盖率输出

* npm i istanbul -g
* 执行测试`istanbul cover _mocha`
* open coverage/lcov-report/index.html

[原文](https://www.shiyanlou.com/courses/493/labs/1666/document)