# 入门

## 搭建开发环境

### 创建虚拟环境

### 安装django

* `pip install django==1.8.2` 安装`django`

  ```python
  import django
  django.get_version()
  ```

### 创建项目

- 命令django-admin startproject test1
- 进入test1目录，目录结构如下图：

![默认目录结构](images/test1.png)

###目录说明

- `manage.py`：一个命令行工具，可以使你用多种方式对`Django`项目进行交互
- 内层的目录：项目的真正的Python包
- *_init* _.py：一个空文件，它告诉Python这个目录应该被看做一个Python包
- `settings.py`：项目的配置
- `urls.py`：项目的URL声明
- `wsgi.py`：项目与`WSGI`兼容的Web服务器入口

## 设计模型

### 数据库配置

- 在settings.py文件中，通过DATABASES项进行数据库设置
- django支持的数据库包括：sqlite、mysql等主流数据库
- **Django默认使用SQLite数据库**

### 创建应用

- 在一个项目中可以创建一到多个应用，每个应用进行一种业务处理
- 创建应用的命令：

```
python manage.py startapp booktest
```

- 应用的目录结构如下图

![应用默认目录结构](images/app.png)

* `migrations` 迁移，根据当前项目中的模型类生成数据库脚本，并将脚本映射到数据中去
* `admin.py` 
* `models.py` 模型类的定义
* `tests.py`  测试模块
* `views.py` 视图和函数定义

#### 定义模型

- 有一个数据表，就有一个模型类与之对应
- 打开models.py文件，定义模型类
- 引入包from django.db import models
- 模型类继承自models.Model类
- **说明：不需要定义主键列，在生成时会自动添加，并且值为自动增长**
- 当输出对象时，会调用对象的str方法

```python
from django.db import models

class BookInfo(models.Model):
    btitle = models.CharField(max_length=20)
    bpub_date = models.DateTimeField()

    def __str__(self):
        return self.btitle

class HeroInfo(models.Model):
    hname = models.CharField(max_length=10)
    hgender = models.BooleanField()
    hcontent = models.CharField(max_length=1000)
    hbook = models.ForeignKey(BookInfo)
```

* `python manage.py runserver` 启动

#### 生成数据表

- 激活模型：编辑settings.py文件，将booktest应用加入到installed_apps中，将应用注册

  ![应用列表](images/applist.png)

- 生成迁移文件：根据模型类生成sql语句

  ```
  python manage.py makemigrations
  ```

- 迁移文件被生成到应用的migrations目录

![迁移文件](images/migrate.png)

- 执行迁移：执行sql语句生成数据表

```
python manage.py migrate
```

#### 测试数据操作

- 进入python shell，进行简单的模型API练习

```
python manage.py shell
```

- 进入shell后提示如下：

![python shell](images/shell.png)

- 引入需要的包：

```
from booktest.models import BookInfo,HeroInfo
from django.utils import timezone
from datetime import *
```

- 查询所有图书信息：

```
BookInfo.objects.all()
```

- 新建图书信息：

```
b = BookInfo()
b.btitle="射雕英雄传"
b.bpub_date=datetime(year=1990,month=1,day=10)
b.save()
```

- 查找图书信息：

```
b=BookInfo.objects.get(pk=1)
```

- 输出图书信息：

```
b
b.id
b.btitle
```

- 修改图书信息：

```
b.btitle=u"天龙八部"
b.save()
```

- 删除图书信息：

```
b.delete()
```

#### 关联对象操作

- 对于HeroInfo可以按照上面的操作方式进行
- 添加，注意添加关联对象

```
h=HeroInfo()
h.htitle=u'郭靖'
h.hgender=True
h.hcontent=u'降龙十八掌'
h.hBook=b
h.save()
```

- 获得关联集合：返回当前book对象的所有hero

```
b.heroinfo_set.all()
```

- 有一个HeroInfo存在，必须要有一个BookInfo对象，提供了创建关联的数据：

```
h=b.heroinfo_set.create(htitle=u'黄蓉',hgender=False,hcontent=u'打狗棍法')
h
```

## 管理站点

## 视图

## 模版











