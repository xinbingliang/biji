# 模板

## 介绍

* Django模板语言，简写DTL，定义在django.template包中
* 由startproject命令生成的settings.py定义关于模板的值：
  - DIRS定义了一个目录列表，模板引擎按列表顺序搜索这些目录以查找模板源文件
  - APP_DIRS告诉模板引擎是否应该在每个已安装的应用中查找模板
* 常用方式：在项目的根目录下创建templates目录，设置DIRS值

```
DIRS=[os.path.join(BASE_DIR,"templates")]
```

### 模板处理

1. 加载：根据给定的标识找到模板然后预处理，通常会将它编译好放在内存中

   ```
   loader.get_template(template_name)，返回一个Template对象
   ```

2. 渲染：使用Context数据对模板插值并返回生成的字符串

   ```
   Template对象的render(RequestContext)方法，使用context渲染模板
   ```

3. 代码

   ```
   from django.template import loader, RequestContext
   from django.http import HttpResponse

   def index(request):
       tem = loader.get_template('temtest/index.html')
       context = RequestContext(request, {})
       return HttpResponse(tem.render(context))
   ```

### 快捷函数

- render_to_string("") 使用字符串当作模板
- render(request,'模板',context)

```
from django.shortcuts import render

def index(request):
    return render(request, 'temtest/index.html')
```

## 定义模板

模板语言包括

- 变量
- 标签 { % 代码块 % }
- 过滤器
- 注释{# 代码或html #}

### 变量

- 语法：

```
{{ variable }}
```

- 当模版引擎遇到一个变量，将计算这个变量，然后将结果输出
- 变量名必须由字母、数字、下划线（不能以下划线开头）和点组成
- 当模版引擎遇到点(".")，会按照下列顺序查询：
  1. 字典查询，例如：foo["bar"]
  2. 属性或方法查询，例如：foo.bar
  3. 数字索引查询，例如：foo[bar]
- 如果变量不存在， 模版系统将插入'' (空字符串)
- 在模板中调用方法时不能传递参数

###在模板中调用对象方法

- 在models.py中定义类HeroInfo

```
from django.db import models

class HeroInfo(models.Model):
    ...
    def showName(self):
        return self.hname
```

- 在views.py中传递HeroInfo对象

```
from django.shortcuts import render
from models import *

def index(request):
    hero = HeroInfo(hname='abc')
    context = {'hero': hero}
    return render(request, 'temtest/detail.html', context)
```

- 在模板detail.html中调用

```
{{hero.showName}}
```

### 标签

- 语法：{ % tag % }
- 作用
  - 在输出中创建文本
  - 控制循环或逻辑
  - 加载外部信息到模板中供以后的变量使用
- for标签

```
{ %for ... in ...%}
循环逻辑
{{forloop.counter}}表示当前是第几次循环
{ %empty%}
给出的列表为或列表不存在时，执行此处
{ %endfor%}
```

- if标签

```
{ %if ...%}
逻辑1
{ %elif ...%}
逻辑2
{ %else%}
逻辑3
{ %endif%}
```

- comment标签

```
{ % comment % }
多行注释
{ % endcomment % }
```

- include：加载模板并以标签内的参数渲染

```
{ %include "foo/bar.html" % }
```

- url：反向解析

```
{ % url 'name' p1 p2 %}
```

- csrf_token：这个标签用于跨站请求伪造保护

```
{ % csrf_token %}
```

- 布尔标签：and、or，and比or的优先级高
- block、extends：详见“模板继承”
- autoescape：详见“HTML转义”

### 过滤器

### 注释



## 模板继承



## HTML转义



## CSRF



## 验证码





