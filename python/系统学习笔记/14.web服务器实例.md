# web服务器实例

* 应用层：解决要传递什么数据，接收请求后要响应什么数据
* 传输层：解决如何传输数据UDP/TCP
* 网络层：目标的位置(IP)
* 链路层：具体传输工具



## HTTP 请求方式

* `GET` 获取数据
* `POST` 修改数据
* `PUT` 保存数据
* `DELETE` 删除
* `OPTION` 询问服务器的某种支持特性
* `HEAD` 返回报文头 

## 静态文件服务器

```python
# -*- coding: utf-8 -*-
from socket import *
from multiprocessing import *
import re

# 静态文件根目录
HTML_ROOT_DIR = './html'


def client_handle(client_socket, client_addr):
    """
    处理客户端请求
    :param client_socket: 客户端socket
    :param client_addr: 客户端地址
    :return:
    """
    # 客户端数据获取
    request_data = client_socket.recv(1024)
    #print(str(request_data))

    request_lines = request_data.splitlines()

    for line in request_lines:
        print(line)

    request_start_line = request_lines[0]
    file_name = re.match(r"\w+ +(/[^ ]*) ", request_start_line.decode('utf-8')).group(1)
    print(file_name)


    if "/" == file_name:
        file_name = '/index.html'

    # 打开文件
    file_name = HTML_ROOT_DIR + file_name
    print(file_name)

    try:
        file = open(file_name, 'rb')
    except IOError:  # 文件打开异常
        response = 'HTTP/1.1 404 Not Found\r\nServer: my server\r\n\r\n' + '404 Not Found!'
    else:
        file_data = file.read()
        file.close()

        # 构造响应数据
        response = 'HTTP/1.1 200 OK\r\nServer: my server\r\n\r\n' + file_data.decode("utf-8")
    finally:
        # 向客户端返回数据
        client_socket.send(bytes(response, 'utf-8'))
        # client_socket.send(response)
        # 关闭客户端连接
        client_socket.close()


def main():
    server_socket = socket(AF_INET, SOCK_STREAM)

    server_socket.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1) # socket级别 重用地址 值为1
    server_addr = ("", 8000)
    server_socket.bind(server_addr)
    server_socket.listen(128)

    while True:
        client_socket, client_addr = server_socket.accept()
        print('有新客户端到来【%s】' % str(client_addr))

        client_process = Process(target=client_handle, args=(client_socket, client_addr))

        client_process.start()
        client_socket.close()

if __name__ == '__main__':
    main()
```










