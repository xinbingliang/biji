# urllib

## urllib.urlopen

### 方法

* `url:scheme（http:/file:）`指定远程的服务器地址，当然它也支持本地的软件读取
* data：如果有，变成POST方法，也就是对服务器POST数据，当然这个POST比较简单，数据格式必须是application/X-www-form-urlencoded，就是类似于在登录的时候输入用户名密码这种。
* 返回类文件句柄

### 类文件句柄使用方法

* read（size）size=-1/None 读字节
* readline（）读一行
* readlines（）所有的行都会读出来，它返回的是一个链表
* close（）把这个文件给关闭掉
* getcode（）返回http请求的应答码200，2xx就是正确的应答码

```python
import urllib

def demo():
    s = urllib.urlopen('http://blog.kamidox.com')
    # print(s.read(100))
    # print(s.read())
    # print(s.readline())
    # print(s.readlines())
    print(s.getcode())


if __name__ == '__main__':
    demo()
```

## HTTPMassage

### 方法

## 方法

- `info()`返回`httplib.HTTPMassage`实例


- `httplib.HTTPMassage`
  - `Headers` 头信息
  - `gettype()` 获取它的媒体类型
  - `getheader()/getheaders()` 从打印的头信息中获取到头的字段
  - `Items()/keys()/values()`打印出所有的头出来

### 示例

````python
import urllib

def print_list(list):
    for i in list:
        print(i)

def demo():
    s = urllib.urlopen('http://blog.kamidox.com')
    msg = s.info()
    print_list(dir(msg))
    # print_list(msg.items())
    # print_list(msg.headers)
    print(msg.getheader('Content-type'))

if __name__ == '__main__':
    demo()
````

## urllib.urlretrieve

将远程文件下载到本地

### 方法

* url: 远程地址
* filename; 要保存到本地的文件
* reportthook 下载状态报告
* data：POST的application/x-www-form-urlencoded格式的数据
* 返回（filename，HTTPMassage）

### 示例

**简单使用**

````python
import urllib

def print_list(list):
    for i in list:
        print(i)

def retrieve():
    fname, msg = urllib.urlretrieve('http://blog.kamidox.com', 'index.html')

    print(fname)                #获得输出文件
    print_list(msg.items())     #打印头信息


if __name__ == '__main__':
    retrieve()
````

**使用reporthook**

1. 参数1：当前传输的块数

2. 参数2：块大小

3. 参数3：数据总大小

   需要注意：content-length不是必须的

```python
import urllib

def print_list(list):
    for i in list:
        print(i)

def progress(blk, blk_size, total_size):
    print((float)(blk*blk_size)*100/total_size)


def retrieve():
    fname, msg = urllib.urlretrieve('http://blog.kamidox.com', 'index.html', reporthook=progress)


if __name__ == '__main__':
    retrieve()
```













