# 权限管理

## 进程也有属主和属组

安全上下文：用户去开启一个进程,会和进程的属主和属主进行比较以获得执行权限参数，进程代替用户去操作计算机，此时进程就代表用户，当有被操作对象时，会让发起人和操作对象的属主和属组进行比较。

## RWX

### 文件

* r 可读 使用cat命令可以查看文件的内容
* w 可写 可以使用编辑软件修改文件的内容
* x 可执行

### 目录

* r 可以针对该目录使用ls 命令列出所有的文件
* w 可以在该目录下创建文件，删除该目录下的文件和目录，移动文件
* x 可以使用cd命令进入该目录

## 权限文件的存放位置

|    用户    | UID  |   /etc/passwd    |
| :------: | :--: | :--------------: |
| **用户组**  | GID  |  **/etc/group**  |
| **影子口令** |      | **/etc/shadow**  |
| **组口令**  |      | **/etc/gshadow** |

## 用户和用户组

* 管理员	uid 0
* 普通用户（1-65535）
  * 系统用户 (1-499) 不能登录
  * 一般用户(500-6000)

*****

* 管理员组
* 普通组
  * 系统组
  * 一般组

私有组：创建用户时，如果没有为其指定一个组，系统自动创建一个与用户名同名的组

基本组：用户默认的组

附加组：又称额外组，默认组以外的其他组

## 权限文件的组成

### /etc/passwd

* account 用户名
* passwd 密码占位符
* UID 
* GID
* 全名等信息
* HOME DIR 家目录位置
* SHELL 默认shell

### /etc/shadow

* account 登录号
* enrtypted passwd 加密密码(*或!!直接上锁)
* 上次修改时间
* 密码最少使用天数（0）
* 密码最长使用天数
* 过期之前多少天进行提示
* 过期之后禁用之前的天数（宽限）不改不能登录
* 禁用时间
* 保留字段

### /etc/group

* 组名
* 密码
* 组ID
* 附加组用户列表(使用,隔开)

## 加密

* 对称加密：加密和解密使用同一个密码
* 公钥加密：每个，密码成对出现，一个为私钥（secret key），一个为公钥（public key），公钥只能使用配对的私钥进行解密
* 单向加密，散列加密（指纹加密）：提取数据特征码
  * 雪崩效应（防止逆向工程）
  * 定长输出

`md5`：信息摘要，128位定长

`sha1`：安全哈希算法，160位定长

`sha512`：军用级别

* `md5sum`md5加密

  -b 以二进制文件模式读取文件内容

  -t 以文本模式读取文件的内容

  -c 根据已经生成的md5值，对已经有的文件校验

  --status 校验完成后，不生成错误或正确的提示信息，可以通过命令的返回值来判断

  `md5sum 1.txt`

  `md5sum -c 1.md5`对文件md5进行校验。校验时，根据已生成的md5来进行校验。生成当前文件的md5，并和之前已经生成的md5进行对比，如果一致，则返回OK，否则返回错误信息

  ` md5sum -c --status data.md5 `

## 管理基础命令

* `ls -l $(which useradd)` 命令文件信息

## 用户操作

* `useradd` 添加用户

  ​-u 指定uid（当不指定的时候uid和gid会保持一致，不一致会成为特殊用户）

  ​-g 默认组

  ​-G 指定额外的附加组(多个用,隔开)

  ​-c 指定注释，有空格要用""

  ​-d 指定家目录

  ​-s 指定shell (一定丝/etc/shells中已经有的)

  ​-m 强制为用户创建家目录

  ​-M 不为用户创建家目录

  ​-r 创建系统用户

  ​`useradd -m -G root -c "xinbingliang"  bing`

* 相关文件

  ​`/etc/default/useradd` 密码配置文件的位置

  ​`/etc/skel`的shell的配置文件文件

  ​`/etc/login.defs`对shadow的默认配置

  ​`/etc/shell` 系统中的安全shell

* userdel 删除用户(默认家目录不会被删除)

  ​	-r 连家目录一起删除


* id username 

  ​	-u uid 

  ​	-g gid

  ​	-G 所有组的名字

  ​	-n 以名字显示

  `id -Gn bing`


* finger 查看用户信息

  ​	`finger bing`

* `usermod` 修改账户信息

          -u 改uid    

          -g 改基本组

          -G 替换附加组

          -aG 添加附加组

          -c 注释信息

          -d 改家目录(原目录会不能访问)

          -dm 使原目录下的文件复制过来

          -s 修改shell

          -l 修改登录名

          -e 指定过期时间

          -f 指定非活动时间

          -L 锁定用户的账户

          -U 解锁

* chsh 修改shell

  `chsh xin` 回车

* `chfn` 修改详细信息

* `passwd `密码操作

      -l 锁定

      -u 解锁

      -n 最短使用期限

      -x 最长使用时间

      -w 警告时间

      -i 非活动时间

      -d 删除用户密码

  ​    `passwd --stdin` 重标准输入中读取  

* pwck 检查帐号的问题，检查完整性

* groupadd 

  ​    -g 指定gid

  ​    -r 指定系统组 

* groupmod

  ​    -g gid

  ​    -n 组名

* `groupdel` 删除组

* `gpasswd` 组名 给组加密

* `newgrp` 基本组的临时切换用户会要求输入密码

* `chage` 更改用户的过期信息

      -d 最近一次修改时间

      -E 过期时间

      -I 非活动时间    

      -m 最短使用时间

      -M 最长使用时间

      -W 警告时间

* `tail -1 /etc/passwd` 查看最后一行

* `passwd username` 修改密码

* `groupadd` 增加用户组

## 权限的修改

三类用户

​	u：属主

​	g：属组

​	o：其他用户

* chown 改变用户的属主（只有管理员可以使用该命令）

  `chown username file` 修改属组

  -R 递归修改，修改自己和内部的所有

  --reference 引用参数

  `chown -R --reference=./my .`将两者的数主修改的一样


* chgrp 改变所属组(管理员使用)

​	-R 递归修改

​	--reference 应用其他文件的权限

​	`chgrp -R --reference=my .`

`chown username:groupname file`

`chown root:root ./my`

`chown :root ./my`

`chown -R --reference=./my .`

* chmod 修改文件权限

​	`chmod 644 file`

​	-R

​	--reference 

​	75=075

​	`chmod -R --reference=./my .`

* 修改某一类用户的权限

​	`chmod u=rwx file`

​	`chmod g=rx file`

​	`chmod g=rx,o=rw file`

​	`chmod go=rw file`

* 某一位权限

​	`chmod 用户类别+-权限 file`

​	`chmod u-x file`

### 手动创建用户

1. 修改/etc/group

2. 修改/etc/passwd

3. 修改/etc/shadow

4. cp -r /etc/skel /home/username

5. chown -R username:username /home/username

6. chmod -R go=/home/username

7. 密码

       whatis passwd

       man sslpasswd

       加盐

       openssl passwd -1 -salt '8位' 

       修改/etc/shadow

### umask权限遮罩（出现就被过滤掉）

666-umask

777-umask

## shell

1. 登录shell

   正登录过去的

   `su - username`

   `su -l`

2. 非登录shell

   `su username`

   图形界面下的命令行窗口

   自动执行的非shell也为非登录

### bash的配置文件

1. 全局配置文件

   `/etc/profile` `/etc/profile.d/*.sh` `/etc/bashrc` 对所有用户都有效

2. 个人配置文件

* profile 类

设定环境变量

运行命令或脚本（准备工作）

* bashrc 类

设置本地变量

定义命令别名

### shell 配置读取顺序

登录式shell对配置文件读取

`/etc/profile->/et/profile.d/*.sh->~/.bash_profile->~/.bashrc->/etc/bashrc`

非登录式shell对配置文件的读取

`~/.bashrc->/etc/bashrc->/etc/profile.d/*.sh`