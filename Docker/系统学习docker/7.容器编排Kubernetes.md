# 容器编排Kubernetes

## Kubenetes简介

* node：指节点
* pod：容器调度的最小单位，指具有相同NameSpace的容器组合
* kubelet：负责node上容器管理的代理
* kube-proxy：端口的代理和转发及负载均衡
* fluentd：日志的采集、存储及查询

## Minikube快速搭建K8S单节点环境

[文档](https://github.com/kubernetes/minikube)

[文档](https://github.com/kubernetes/minikube/blob/master/docs/drivers.md#kvm2-driver)

https://blog.csdn.net/metheir/article/details/85108276

https://blog.csdn.net/qq_26188449/article/details/77574890

`````
curl -LO http://pn955ssao.bkt.clouddn.com/kubectl
chmod +x ./kubectl
sudo mv ./kubectl /usr/local/bin/kubectl

curl -LO http://pn955ssao.bkt.clouddn.com/minikube-linux-amd64 && sudo install minikube-linux-amd64 /usr/local/bin/minikube

sudo apt install libvirt-clients libvirt-daemon-system qemu-kvm
sudo usermod -a -G libvirt $(whoami)
newgrp libvirt
curl -LO http://pn955ssao.bkt.clouddn.com/docker-machine-driver-kvm2 && sudo install docker-machine-driver-kvm2 /usr/local/bin/
minikube start --vm-driver=kvm2 --iso-url http://pn955ssao.bkt.clouddn.com/minikube-v0.34.0.iso
`````

`````sh
#!/bin/bash
images=(
kube-apiserver:v1.13.3
kube-controller-manager:v1.13.3
kube-scheduler:v1.13.3
kube-proxy:v1.13.3
pause:3.1
etcd:3.2.24
)
for imageName in ${images[@]} ; do
	docker pull mirrorgooglecontainers/$imageName
	docker tag mirrorgooglecontainers/$imageName k8s.gcr.io/$imageName
	docker rmi mirrorgooglecontainers/$imageName
done

docker pull coredns/coredns:1.2.6
docker tag coredns/coredns:1.2.6 k8s.gcr.io/coredns:1.2.6
docker rmi coredns/coredns:1.2.6
`````

```
sudo snap install --classic kubeadm
```

````
sudo dpkg -i virtualbox-6.0_6.0.4-128413~Ubuntu~bionic_amd64.deb
sudo apt-get install -f
````

## K8S最小调度单位Pod

* 共享一个`namespace`

````yaml
# pod_nginx.yml 
apiVersion: v1
kind: Pod
metadata:
  name: nginx
  labels:
    app: nginx
spec:
  containers:
  - name: nginx
    image: nginx
    ports:
    - containerPort: 80
````

* `kubectl create -f pod_nginx.yml` 创建一个pod
* `kubectl delete -f pod_nginx.yml ` 删除pod
* `kubectl get pods` 常看pod
* `kubectl get pods -o wide` 显示pod详细信息
* `kubectl exec -it nginx sh` 进入容器，默认进入第一个容器，-c
* `kubectl describe pods nginx` 打印pod信息
* `kubectl port-forward nginx 8080:80` 进行端口映射

## ReplicaSet和ReplicationController

* `kubectl delete -f pod_nginx.yml` 删除pod
* `kubectl get pods` 查看pod

````yaml
# rs_nginx.yml 新
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: nginx
  labels:
    tier: frontend
spec:
  replicas: 3
  selector:
    matchLabels:
      tier: frontend
  template:
    metadata:
      name: nginx
      labels:
        tier: frontend
    spec:
      containers:
      - name: nginx
        image: nginx
        ports:
        - containerPort: 80
````

````yaml
# rc_nginx.yml
apiVersion: v1
kind: ReplicationController 
metadata:
  name: nginx
spec:
  replicas: 3
  selector:
    app: nginx
  template:
    metadata:
      name: nginx
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx
        ports:
        - containerPort: 80
````

* `kubectl create -f rs_nginx.yml` 
* `kubectl get rs`
* `kubectl get pods`
* `kubectl delete pods nginx-9dp92` 删除一个
* `kubectl scale rs nginx --replicas=2` 将扩展控制在两个
* `kubectl get pods -o wide`

## Deployment

## 使用Tectonic在本地搭建多节点K8S集群



##  k8s基础网络Cluster Network



## Service简介和演示



## NodePort类型Service以及Label的简单实用



## 准备工作——使用kops在亚马逊AWS上搭建k8s集群



## 使用kops在亚马逊AWS上搭建k8s集群



## LoadBlancer类型Service以及AWS的DNS服务配置

## 在亚马逊k8s集群上部署wordpress