# 视频笔记

* 文档数据库(`Bson`->即`json`的二进制化)
* 内部引擎使用`javascript`
* mongo文档型数据库没有特定结构

## 安装

* 2.4.8
* [中文社区文档](http://docs.mongoing.com/manual-zh/)

## 文件和作用

* bsondump.exe 导出bson结构
* mongo.exe 客户端
* mongod.exe 服务端
* mongodump.exe 整体数据库导出
* mongoexport.exe 导出人类易读json或csv
* mongofiles.exe 
* mongoimport.exe
* mongooplog.exe
* mongoperf.exe
* mongorestore.exe 数据库整体导入
* mongos.exe 路由器，集群时使用
* mongostat.exe 
* mongotop.exe 

## 启动

* mongod --dbpath 数据存放位置 --logpath 日志存放位置/xxx.log --fork  --port 27017
* --fork 后台进程
* --smallfiles 以最小化启动

## 命令操作

* show dbs; 查看库
* use dbsName; 使用一个库/或创建一个库
* show collections; 查看表
* db.createCollection('文档名称');创建表(实际上没有显示声明创建的必要)

### 增

* db.test.insert({"name":"辛丙亮","age":"24"}); 添加一条文档
* db.test.insert({"_id": 2, "name":"么么哒","age":"24"}); 指定id不让表默认生成id

### 删

* db.collectionName.drop(); 删除一个表
* db.dropDatabase(); 删除库
* db.test.remove({_id:2}) 删除一个记录/没有条件可以清空数据
* db.test.remove({_id:2, true}) 删除匹配到的第一行

### 改

- $inc 增长
- $rename  重命名列
- $setOnlnsert 当Upsert时，设置字段的值
- $set 设置字段的新值
- $unset 删除指定的列



*  db.test.update({sn:'002'}, {name:'辛丙亮'}) 将整个文档替换
*  db.test.update({sn:'003'}, {$set:{name:'辛丙亮'}}) 修改一个字段

### 查

* db.test.find(); 查询数据

* db.collection.find(查询表达式,查寻的列)

  ```
  db.test.find({}) 所有文档的所有的列
  db.test.find({}, {gender:1}) 所有gender为1 的属性
  db.test.find({}, {gender:1, _id: 0}) 所有gender为1 的属性并不显示id
  db.test.find({gender:'male'}, {name:1,_id: 0}) 所有male的姓名
  ```

## CURD



## 比较运算符

* $gt    >
* $gte     >=
* $in    in
* $lt    <
* $lte    <=
* $ne    !=
* $nin    not in
* $all    无对应项,指数组所有单元匹配

## 逻辑运算符

* $or    or
* $and     and
* $not    not
* $nor    无对应项，指所有列举条件都不成功则为"真"

## 元素运算符

* $exists    某列存在则为真
* $mod    满足某求余条件者为真
* $type    数据为某类型则为真

## Javascript运算符

* $where js表达式为真则为真
* $regex    正则表达式匹配则为真
* $inc 增长
* $rename  重命名列
* $setOnlnsert 当Upsert时，设置字段的值
* $set 设置字段的新值
* $unset 删除指定的列


````
db.test.update(
{name: 'wukong'},	查询表达式
$set: {name: 'dzsf'}, 修改值  后面统称赋值表达式
$unset: {jingu: 1}, 删除字段
$rename: {sex: 'gender'}, 重命名
$inc: {age:16} +16
)
````

option：

`{upsert: true/false, multi: true/false}`

`Upsert` 指没有匹配的行就插入该行

`multi` 是指修改多行

````
db.test.update({gender: 'm'}, {$set: {
  gender: 'male'
}},{multi: true})
````

## 深入查询表达式

### mysql->mongo

* json_encode()

### 例子

1. 最简单的查询表达式

   ````
   {filed: value} 是指查询field列的值为value的文档
   ````

2. $ne   !=查询表达式

   ````
   {field: {$nq: value}} 查filed列的值不等于value的文档
   db.test.find({cat_id: {$nq: 3}}, {cat_id:1, goods_name:1, _id:0}) 指定查询的字段
   ````

3. $nin   not in

   ````
   db.test.find({cat_id: {$in: [4, 11]}}, {catid:1, goods_name: 1, _id: 0})
   ````

4. $gt 大于某个值

   ````
   db.test.find({shop_price: {$gt: 3000}}, {goods_name: 1, shop_price: 1, _id: 0})
   ````

5. $lte 低于或等于

   ````
   db.test.find({shop_price: {$lte: 100}}, {goods_name:1, shop_price: 1})
   ````

6. $all 

   ````
   语法：{field: {$all: [v1, v2]}}
   是指取出field列是一个数组，且至少包含v1、v2值
   ````

7. or 或

   ````
   db.test.find({$and; [{price: {$gt: 100}, {$price: {$lt: 500}}}]})
   ````

8. and

   ```
   db.test.find({$and:[{shop_price:{$gte: 100}}, {shop_price: {$lte: 500}}], {goods_name: 1, shop_price: 1, _id: 0})
   ```

9. 实现且

   ```
   db.test.find($and:[{cat_id: {$ne: 3}}, {cat_id: {$ne: 11}}], {$goods_name: 1, cat_id: 1})
   db.test.find({cat_id: {$nin: [3, 11]}}, {goods_name: 1, cat_id: 0})
   db.test.find({$nor:[{cat_id:3}, {cat_id:11}]}, {goods_name: 1, cat_id: 1})
   ```

10. not

    ```

    ```

11. $mod 满足某求余条件为真

    ````
    db.goods.find({goods_id: {$mod: [5, 0]}}, {}) 	goods_id%5 = 0
    ````

12. $type 数据为某类型则为真(严格存储类型)

    ```
    db.test.find({age; {$type: 2}}) //字符串类型
    ```

13. $all 指定内容必须有

    ````
    db.stu.find({hobby: {$all: ['b', 'c']}})
    ````

14. $exists 文档有没有某一列，存在就取出

    ````
    语法：{field: {$exists: 1}}
    作用:查询出含有field字段的文档
    db.stu.find({age: {$exists:1}})
    ````

15. $nor 即不是也不是

    ````
    db.test.find({$nor:[{cat_id:3}, {cat_id:11}]}, {goods_name: 1, cat_id: 1})
    ````

16. 用where 表达式来查询

    ```
    db.test.find({$where: 'this.price>5000'})
    ```

17. $regex 正则表达式匹配则为真

    ````
    db.test.find({goods_name: {$regex: /^诺基亚.*/}})
    ````

## 游标操作

```
for (var i = 0; i< 10000;i++){
  db.bar.insert({_id; i+1, title: 'Hello'});
};
```

游标：通俗的说，不是查询结果而是查询的返回资源，通过这个接口逐条读取

### 游标的声明

````
var cursor = db.collectionName.find(query, projection);
cursor.hasNext(); 判断游标是否到达尽头
cursor.Next(); 取出游标的下一个单元

printjson(cursor.next()); 打印出一行
````













